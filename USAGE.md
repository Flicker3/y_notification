# 使用指南：数据变化通知系统

## 核心功能验证

本系统确保以下行为：**数据持续变化时通知保持显示并更新内容，数据停止变化后延时消失**。

## 快速验证步骤

### 1. 启动测试
```bash
npm run dev
# 或直接打开 test-working.html 文件
```

### 2. 验证数据监控功能

#### 场景A：计数器持续变化
1. 点击"启动自动计数"按钮
2. 观察通知：**通知保持显示，内容实时更新**（计数器值持续变化）
3. 点击"停止自动计数"按钮
4. 观察通知：**数据停止变化后2秒，通知自动消失**

#### 场景B：实时数据模拟
1. 点击"启动传感器"按钮
2. 观察通知：温度和湿度数据持续变化时，通知内容实时更新
3. 点击"停止传感器"按钮
4. 观察通知：数据停止变化后，通知延时消失

## 核心代码说明

### 关键实现逻辑

```javascript
// 每次数据变化时：
1. 清除之前的关闭定时器
2. 更新现有通知内容（不重新创建）
3. 重置关闭定时器

// 数据停止变化时：
定时器触发 → 通知消失（延时关闭）
```

### 防抖机制
- 数据变化间隔：任何频率
- 延时关闭时间：可配置（默认2秒）
- 行为保证：**数据持续变化时绝不错误关闭**

## 使用示例

### 基本数据监控
```typescript
const counter = ref(0)
const monitor = dataNotification.watch(counter, {
  title: '计数器监控',
  duration: 2000  // 数据停止变化后2秒消失
})

// 测试：持续增加计数
setInterval(() => counter.value++, 500)  // 通知保持显示
// 停止增加后2秒，通知自动消失
```

### 实时数据流
```typescript
const sensorData = reactive({ temp: 25, humidity: 60 })
dataNotification.watch(sensorData, {
  title: '传感器数据',
  formatMessage: (newVal) => `温度: ${newVal.temp}°C, 湿度: ${newVal.humidity}%`
})
```

## 测试验证工具

- **test-working.html** - 独立测试页面，无需构建
- **npm run dev** - 完整Vue应用测试
- **浏览器控制台** - 可查看实时日志

## 问题解决确认

✅ **已修复问题**：之前版本中每次数据变化都会重置关闭定时器，导致过早关闭
✅ **当前行为**：数据持续变化时通知保持存在，数据停止变化后延时关闭
✅ **验证方法**：使用test-working.html进行实际测试